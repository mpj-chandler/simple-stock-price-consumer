<!DOCTYPE html>
<html>
    <head>
        <title>Simple Stock Price Consumer</title>
    </head>
    <body>
        <ul id="priceHistory"></ul>
        <p id="price"></p>
        <p id="dump"></p>
        <script>
            const socket = new WebSocket('wss://ws.finnhub.io?token={{FINNHUB_API_KEY}}');

            socket.addEventListener('open', function (event) {
                socket.send(JSON.stringify({'type':'subscribe', 'symbol': 'AAPL'}))
            });

            socket.addEventListener("message", function (event) {
                const payload = JSON.parse(event.data);
                switch (payload.type) {
                    case "trade":
                        payload.data.forEach((element) => {
                            const li = document.getElementById("priceHistory").appendChild(document.createElement("li"));
                            li.textContent = `$${element.p}`;
                    });

                        document.getElementById("price").textContent = `$${payload.data[0].p}`;
                    case "ping":
                    default:
                        break;
                }
                
            });

            var unsubscribe = function(symbol) {
                socket.send(JSON.stringify({'type':'unsubscribe','symbol': symbol}))
            };
        </script>
    </body>
</html>